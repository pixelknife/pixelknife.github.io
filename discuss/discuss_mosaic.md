# 大幅面调色

制作大面积（省市以上）的遥感底图，是一个重要的工作内容。
是一个可以盘活我们的数据资源、算法资源、设施资源的核心业务。

对于几何定位等工作，都有比较确定的定量化指标。而调色相对来说比较随意，客户的意见有的时候也飘忽不定。

为此我们努力做一些标准化的工作

首先以GE上2020年LANDSAT的底图为基础，虽然耕地等区域的颜色不同季节之间变化比较大，但是在冬季以外的季节，城市、森林的颜色变化还是比较小的。目前以64米为参考基准。

也在考虑是否可以通过MODIS制作256米的月度产品，然后以这个作为基准。假设GF1幅宽70公里，那么256米尺度，相当于缩略图280像素，感觉有点太小。


## 1 准备
准备目录

* REGION
    * PATH-GROUP
        * PATH
* LANDSAT


LANDSAT的数据集准备好，放到LANDSAT目录，制作成REGION大一些的区域，投影和最后要镶嵌制图一样。
我觉得原来的LANDSAT太绿了（三个波段的直方图差别很大），对于分辨率更高的图来说可能影响细节的辨识，所以还会在PS中做个调整。

landsat.tif



GE上原始的Landsat2020

[![hpFY90.jpg](https://z3.ax1x.com/2021/08/22/hpFY90.jpg)

然后，减少过度的绿色，三个波段直方图接近一样。

[](https://imgtu.com/i/hpFY90)
[![hpFt3V.jpg](https://z3.ax1x.com/2021/08/22/hpFt3V.jpg)](https://imgtu.com/i/hpFt3V)



## 2 缩略图

通过VRT将输入的PATH的大小改成32像素整齐，然后用gdaladdo缩小1/32，形成缩略图。

small.tif



## 3 标红

photoshop中用红色铅笔将我们认为应该和LANDSAT底图一致的区域标注出来。要把云和水排除出去，建筑和森林要包含进来，而农田之类则要斟酌。

mark.tif

## 4 白平衡

通过matlab脚本，将标红区域的三个波段的均值方差调成一样。比较成果图，看看是否合适，也可以回到第3步，再调整标红区域。

small_wb.tif

比较算法效果

[![hpk2in.jpg](https://z3.ax1x.com/2021/08/22/hpk2in.jpg)](https://imgtu.com/i/hpk2in)
左边是Landsat对应区域，右边是高分卫星数据参考左边生成的。

可以通过-scale的参数建立一个VRT文件，而不需要直接生成新图像文件。

## 5 全区曲线

通过gamma变化（photoshop中的曲线拉伸工具），调整直方图,可以压缩高亮度区域的亮度空间范围，而拉伸暗区域的亮度空间范围。

目前采用GDAL的-exponent 0.2建立VRT文件，而不需要直接生成新图像文件。

small_wb_exp.tif


## 6 调色

再通过photoshop的阴影高光工具做一些调整，相当于把光场调整得更加均匀。这样更有利于高分辨率图像在暗区域得表现。

通过photoshop的锐化工具，可以导致缩略局部的数值方差扩大，这样导致后续模仿的时候图像对比度更大。

总的来说就是让均值的差异缩小，但是局部变化幅度扩大。

small_wb_exp_ps.tif

[![hpkRGq.jpg](https://z3.ax1x.com/2021/08/22/hpkRGq.jpg)](https://imgtu.com/i/hpkRGq)


## 7 应用到全分辨率

前面的调色都是缩略图上，现在要迁移这个调色方案到全分辨率图像上。这是一个16位图像，超过255数值的部分就是过饱和的。

lin.tif

## 8 局部去饱和

在局部过亮过饱和的区域附近展开搜索，找到一个最佳的亮度空间压缩方案，通过局部直方图调整，尽可能恢复一些纹理信息。

enh.tif






---


**联系方式**

陈甫 副研究员
中国科学院空天信息创新研究院
chenfu@aircas.ac.cn
13811147935